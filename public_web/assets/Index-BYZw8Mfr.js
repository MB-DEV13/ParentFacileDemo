import{r as h,u as C,j as t}from"./index-DzDZ6tjL.js";import{u as P}from"./useApi-DpnssBU5.js";import{f as T,d as E,a as k}from"./api-B92zqhbA.js";import{n as j,t as A}from"./tags-B1DDbKTZ.js";const B="/assets/family_2-aDAZXwry.png",I=["Grossesse","Naissance","1–3 ans"],N={Grossesse:0,Naissance:1,"1–3 ans":2};function y(i=""){return String(i).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s-]/g," ").replace(/\s+/g," ").trim()}function D(i,u){if(i===u)return!0;const s=i.length,o=u.length;if(Math.abs(s-o)>1)return!1;if(s>o)return D(u,i);let l=0,d=0,a=0;for(;l<s&&d<o;){if(i[l]===u[d]){l++,d++;continue}if(a++,a>1)return!1;s===o&&l++,d++}return!0}function S(i,u){const s=y(i),o=y(u);if(!o||s.includes(o))return!0;const l=s.split(" ");return o.split(" ").every(a=>l.some(x=>x.includes(a)||D(x,a)))}function z(){const{data:i,loading:u,error:s}=P(T,[]),o=h.useMemo(()=>(i?.documents||[]).map(e=>({...e,tag:j(e.tag)})),[i]),[l,d]=C(),[a,x]=h.useState(l.get("q")||""),[c,p]=h.useState(l.get("tag")||"");h.useEffect(()=>{x(l.get("q")||""),p(l.get("tag")||"")},[l]),h.useEffect(()=>{const e=setTimeout(()=>{const r=new URLSearchParams;a&&r.set("q",a),c&&r.set("tag",c),d(r,{replace:!0})},150);return()=>clearTimeout(e)},[a,c,d]);const g=h.useMemo(()=>{let e=o;const r=a.trim();return r&&(e=e.filter(n=>S(String(n.label||""),r)||S(String(n.tag||""),r))),c&&(e=e.filter(n=>n.tag===c)),[...e].sort((n,m)=>{const f=N[n.tag]??99,b=N[m.tag]??99;if(f!==b)return f-b;const v=n.order??999,w=m.order??999;return v!==w?v-w:String(n.label).localeCompare(String(m.label),"fr")})},[o,a,c]);return h.useEffect(()=>{const e=window.matchMedia("(prefers-reduced-motion: reduce)").matches,r=document.querySelectorAll(".js-reveal");if(!r.length)return;if(e){r.forEach(m=>m.classList.add("in-view"));return}const n=new IntersectionObserver(m=>{m.forEach(f=>{f.isIntersecting&&(f.target.classList.add("in-view"),n.unobserve(f.target))})},{threshold:.1,rootMargin:"0px 0px -10% 0px"});return r.forEach(m=>n.observe(m)),()=>n.disconnect()},[g.length]),t.jsx("section",{className:"py-16 bg-pfYellow",children:t.jsxs("div",{className:"max-w-6xl mx-auto px-4",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4 mb-6 sm:mb-8",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-slate-900",children:"Documents à télécharger"}),t.jsx("p",{className:"text-slate-700 mt-1 text-base",children:"Classés chronologiquement pour aller à l’essentiel."})]}),t.jsx("button",{type:"button",onClick:E,className:"rounded-xl px-4 py-2 text-sm font-medium shadow hover:brightness-110 active:brightness-95 transition w-full sm:w-auto bg-pfBlue text-white",title:"Télécharger tous les PDF en ZIP",children:"Tout télécharger (ZIP)"})]}),t.jsx("div",{className:"mb-6 rounded-2xl overflow-hidden shadow-sm",children:t.jsx("img",{src:B,alt:"Illustration d’une famille — documents utiles",className:"w-full h-48 sm:h-56 lg:h-64 object-cover",loading:"eager",decoding:"async"})}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mb-6",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx("input",{value:a,onChange:e=>x(e.target.value),placeholder:"Rechercher un document (titre, tag)…",className:"w-full rounded-xl border bg-white border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-pfBlue","aria-label":"Rechercher dans les documents"}),t.jsxs("svg",{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 opacity-70 pointer-events-none",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2","aria-hidden":"true",children:[t.jsx("circle",{cx:"11",cy:"11",r:"7"}),t.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx("button",{type:"button",onClick:()=>p(""),className:`rounded-full px-3 py-1.5 text-sm border transition-colors ${c===""?"bg-white shadow font-medium":"hover:bg-white"}`,"aria-pressed":c==="",children:"Tous"}),I.map(e=>t.jsx("button",{type:"button",onClick:()=>p(e===c?"":e),className:`rounded-full px-3 py-1.5 text-sm border transition-colors ${c===e?"bg-white shadow font-medium":"hover:bg-white"}`,"aria-pressed":c===e,children:e},e))]})]}),u&&t.jsx("p",{children:"Chargement…"}),s&&t.jsxs("p",{className:"text-red-600",role:"alert",children:["Erreur : ",String(s.message||s)]}),!u&&!s&&g.length===0&&t.jsx("p",{className:"text-slate-600",children:"Aucun document trouvé pour ces critères."}),!u&&!s&&g.length>0&&t.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-5",children:g.map((e,r)=>t.jsxs("article",{className:`reveal js-reveal [--delay:${r*60}ms] rounded-2xl border bg-white p-4 flex flex-col shadow-sm transition-transform duration-200 hover:shadow-md hover:scale-[1.02] will-change-transform`,"aria-label":`Document ${e.label}`,children:[t.jsx("div",{className:`text-xs font-medium w-fit rounded-md px-2 py-1 mb-2 ${A(e.tag)}`,children:j(e.tag)}),t.jsx("h3",{className:"font-semibold leading-snug flex-1 text-slate-800",children:e.label}),t.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[t.jsx("a",{href:e.public_url,target:"_blank",rel:"noopener noreferrer",className:"text-sm underline text-pfBlue hover:text-pfBlue/80 transition-colors",title:"Ouvrir l’aperçu PDF","aria-label":`Aperçu du document ${e.label}`,children:"Aperçu"}),t.jsxs("button",{type:"button",onClick:()=>k(e.id),className:"ml-auto inline-flex items-center gap-2 rounded-xl px-3 py-1.5 text-sm font-medium text-slate-800 bg-pfBlueLight hover:bg-pfBlueLight/80 transition-colors",title:"Télécharger le PDF","aria-label":`Télécharger le PDF ${e.label}`,children:[t.jsxs("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2","aria-hidden":"true",children:[t.jsx("path",{d:"M12 5v14"}),t.jsx("path",{d:"M19 12l-7 7-7-7"})]}),"PDF"]})]})]},e.id))})]})})}export{z as default};
//# sourceMappingURL=Index-BYZw8Mfr.js.map
