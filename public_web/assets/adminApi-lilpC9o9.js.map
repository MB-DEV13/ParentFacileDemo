{"version":3,"file":"adminApi-lilpC9o9.js","sources":["../../src/services/adminApi.js"],"sourcesContent":["// -------------------------------------------------\r\n// Admin API — ParentFacile (chemins /api/...)\r\n// -------------------------------------------------\r\nconst API_BASE = (import.meta.env.VITE_API_URL || \"\").replace(/\\/$/, \"\");\r\nconst DEFAULT_TIMEOUT = 12000;\r\n\r\nfunction withBase(path) {\r\n  if (!path) return API_BASE || \"\";\r\n  if (/^https?:\\/\\//i.test(path)) return path;\r\n  if (API_BASE) return `${API_BASE}${path.startsWith(\"/\") ? path : `/${path}`}`;\r\n  return path.startsWith(\"/\") ? path : `/${path}`;\r\n}\r\n\r\nasync function request(url, options = {}) {\r\n  const { timeout = DEFAULT_TIMEOUT, ...rest } = options;\r\n  const controller = new AbortController();\r\n  const id = setTimeout(() => controller.abort(), timeout);\r\n\r\n  try {\r\n    const res = await fetch(url, {\r\n      credentials: \"include\",\r\n      headers: { Accept: \"application/json\", ...(rest.headers || {}) },\r\n      signal: controller.signal,\r\n      ...rest,\r\n    });\r\n\r\n    const ct = res.headers.get(\"content-type\") || \"\";\r\n    const isJson = ct.includes(\"application/json\");\r\n    const data = isJson ? await res.json().catch(() => ({})) : await res.text();\r\n\r\n    if (!res.ok) {\r\n      const message =\r\n        (isJson && (data?.message || data?.error)) ||\r\n        (typeof data === \"string\" && data) ||\r\n        `HTTP ${res.status} – ${res.statusText}`;\r\n      const err = new Error(message);\r\n      err.status = res.status;\r\n      err.payload = isJson ? data : { raw: data };\r\n      throw err;\r\n    }\r\n\r\n    return isJson ? data : { raw: data };\r\n  } finally {\r\n    clearTimeout(id);\r\n  }\r\n}\r\n\r\n/* =========================\r\n *        AUTH\r\n * =======================*/\r\nexport const adminLogin = (email, password) =>\r\n  request(withBase(\"/api/admin/auth/login\"), {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify({ email, password }),\r\n  });\r\n\r\nexport const adminLogout = () =>\r\n  request(withBase(\"/api/admin/auth/logout\"), { method: \"POST\" });\r\n\r\nexport const adminMe = () =>\r\n  request(withBase(\"/api/admin/auth/me\"));\r\n\r\n/* =========================\r\n *        DOCS\r\n * =======================*/\r\nexport const adminListDocs = () =>\r\n  request(withBase(\"/api/admin/docs\"));\r\n\r\nexport const adminUploadDoc = (payload) => {\r\n  const fd = new FormData();\r\n  fd.append(\"label\", payload.label);\r\n  fd.append(\"tag\", payload.tag);\r\n  fd.append(\"sort_order\", String(payload.sort_order ?? 999));\r\n  fd.append(\"doc_key\", payload.doc_key);\r\n  fd.append(\"file\", payload.file);\r\n  return request(withBase(\"/api/admin/docs\"), { method: \"POST\", body: fd });\r\n};\r\n\r\nexport const adminDeleteDoc = (id) =>\r\n  request(withBase(`/api/admin/docs/${encodeURIComponent(id)}`), {\r\n    method: \"DELETE\",\r\n  });\r\n\r\nexport const adminUpdateDoc = (id, payload = {}) => {\r\n  const fd = new FormData();\r\n  if (payload.label != null) fd.append(\"label\", payload.label);\r\n  if (payload.tag != null) fd.append(\"tag\", payload.tag);\r\n  if (payload.sort_order != null) fd.append(\"sort_order\", String(payload.sort_order));\r\n  if (payload.doc_key != null) fd.append(\"doc_key\", payload.doc_key);\r\n  if (payload.file) fd.append(\"file\", payload.file);\r\n  return request(withBase(`/api/admin/docs/${encodeURIComponent(id)}`), {\r\n    method: \"PUT\",\r\n    body: fd,\r\n  });\r\n};\r\n\r\n/* =========================\r\n *      MESSAGES\r\n * =======================*/\r\nexport const fetchAdminMessages = (limit = 3) =>\r\n  request(withBase(`/api/admin/messages?limit=${encodeURIComponent(limit)}`));\r\n\r\nexport const fetchAllAdminMessages = () =>\r\n  request(withBase(\"/api/admin/messages/all\"));\r\n\r\n\r\n\r\n"],"names":["API_BASE","DEFAULT_TIMEOUT","withBase","path","request","url","options","timeout","rest","controller","id","res","isJson","data","message","err","adminLogin","email","password","adminLogout","adminMe","adminListDocs","adminUploadDoc","payload","fd","adminDeleteDoc","adminUpdateDoc","fetchAdminMessages","limit","fetchAllAdminMessages"],"mappings":"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"}