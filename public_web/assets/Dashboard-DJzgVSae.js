import{a as R,r,j as e,L as z}from"./index-DzDZ6tjL.js";import{u as F}from"./useApi-DpnssBU5.js";import{b as $,f as q,c as I,d as K,e as U,g as V}from"./adminApi-lilpC9o9.js";import{n as H,a as J}from"./tags-B1DDbKTZ.js";const L=["Grossesse","Naissance","1–3 ans"];function _(a){return String(a||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"")}function ee(){const a=R(),[f,y]=r.useState(!1),[i,g]=r.useState(""),[h,u]=r.useState(""),[p,b]=r.useState(null),[m,j]=r.useState(""),[n,w]=r.useState({label:"",tag:"Grossesse",sort_order:999,doc_key:"",file:null});function o(s,t){w(c=>({...c,[s]:t})),g(""),u("")}const[v,x]=r.useState(0),{data:N,loading:S,error:l}=F($,[v]),{data:D,loading:A,error:k}=F(()=>q(3),[v]),M=r.useMemo(()=>N?.documents||[],[N]),C=r.useMemo(()=>D?.messages||[],[D]);async function T(s){if(s.preventDefault(),u(""),g(""),!n.label||!n.doc_key||!n.file){u("Label, doc_key et PDF requis.");return}try{y(!0),await I(n),g("Document ajouté !"),w({label:"",tag:"Grossesse",sort_order:999,doc_key:"",file:null}),x(t=>t+1)}catch(t){u(t.message||"Erreur ajout document")}finally{y(!1)}}async function O(s){if(confirm("Supprimer ce document ?"))try{await K(s),x(t=>t+1)}catch(t){alert(t.message||"Erreur suppression")}}function P(s){b({...s,sort_order:s.order??s.sort_order??999})}async function G(){try{await U()}finally{a("/admin/login")}}const B=r.useMemo(()=>[...M||[]].sort((s,t)=>{const c=s.order??s.sort_order??999,d=t.order??t.sort_order??999;return c!==d?c-d:String(s.label).localeCompare(String(t.label),"fr")}),[M]);return r.useEffect(()=>{const s=window.matchMedia("(prefers-reduced-motion: reduce)").matches,t=document.querySelectorAll(".js-reveal");if(!t.length)return;if(s){t.forEach(d=>d.classList.add("in-view"));return}const c=new IntersectionObserver(d=>{d.forEach(E=>{E.isIntersecting&&(E.target.classList.add("in-view"),c.unobserve(E.target))})},{threshold:.1,rootMargin:"0px 0px -10% 0px"});return t.forEach(d=>c.observe(d)),()=>c.disconnect()},[S,A,B.length,C.length]),e.jsxs("main",{className:"py-12 min-h-screen bg-gradient-to-br from-pfBlueLight to-pfPink",children:[e.jsxs("div",{className:"max-w-6xl mx-auto px-4",children:[e.jsxs("div",{className:"reveal js-reveal [--delay:60ms] flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-slate-800",children:"Admin – Dashboard"}),e.jsx("button",{onClick:G,className:"rounded-xl px-3 py-1.5 text-sm border border-pfBlue text-pfBlue hover:bg-white transition",children:"Se déconnecter"})]}),!!m&&e.jsx("div",{className:"reveal js-reveal [--delay:100ms] mb-4 rounded-lg px-3 py-2 text-sm bg-green-50 text-green-700 border border-green-200",children:m}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 items-start",children:[e.jsxs("section",{className:"reveal js-reveal [--delay:120ms] bg-white rounded-2xl shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Ajouter un PDF"}),e.jsxs("form",{className:"space-y-3",onSubmit:T,children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Titre (label)"}),e.jsx("input",{className:"w-full rounded-xl border border-slate-300 px-3 py-2 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-pfBlue",value:n.label,placeholder:"Ex: Déclaration de grossesse (CPAM/CAF)",onChange:s=>{const t=s.target.value;o("label",t),n.doc_key||o("doc_key",_(t))}})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Tag"}),e.jsx("select",{className:"w-full rounded-xl border border-slate-300 px-3 py-2 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-pfBlue",value:n.tag,onChange:s=>o("tag",s.target.value),children:L.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Ordre"}),e.jsx("input",{type:"number",className:"w-full rounded-xl border border-slate-300 px-3 py-2 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-pfBlue",value:n.sort_order,onChange:s=>o("sort_order",Number(s.target.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Clé doc (doc_key)"}),e.jsx("input",{className:"w-full rounded-xl border border-slate-300 px-3 py-2 text-sm font-mono bg-white focus:outline-none focus:ring-2 focus:ring-pfBlue",value:n.doc_key,onChange:s=>o("doc_key",_(s.target.value)),placeholder:"ex: declaration-grossesse"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Fichier PDF"}),e.jsx("input",{type:"file",accept:"application/pdf",className:"w-full rounded-xl border border-slate-300 px-3 py-2 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-pfBlue",onChange:s=>o("file",s.target.files?.[0]||null)})]}),e.jsxs("div",{className:"pt-2",children:[e.jsx("button",{type:"submit",disabled:f,className:"rounded-xl px-4 py-2 text-sm font-medium disabled:opacity-60 shadow hover:brightness-110 transition",style:{background:"#5784BA",color:"#fff"},children:f?"Envoi…":"Ajouter"}),h&&e.jsx("p",{className:"text-red-600 text-sm mt-2",children:h}),i&&e.jsx("p",{className:"text-green-700 text-sm mt-2",children:i})]})]})]}),e.jsxs("section",{className:"reveal js-reveal [--delay:160ms] bg-white rounded-2xl shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3 text-slate-800",children:"Documents"}),l&&e.jsx("span",{className:"text-sm text-red-600",children:String(l.message||l)})]}),e.jsx("div",{className:"max-h-[70vh] overflow-auto pr-1",children:S?e.jsx("p",{className:"text-slate-600",children:"Chargement…"}):B.length===0?e.jsx("p",{className:"text-slate-600",children:"Aucun document."}):e.jsx("ul",{className:"space-y-3",children:B.map((s,t)=>e.jsxs("li",{className:"reveal js-reveal rounded-2xl border p-4 bg-white shadow-sm",style:{"--delay":`${200+t*50}ms`},children:[e.jsx("div",{className:"flex items-center justify-between gap-4",children:e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-xs font-medium rounded-md px-2 py-1 mb-1",style:J(s.tag),children:H(s.tag)}),e.jsx("a",{href:s.public_url,target:"_blank",rel:"noreferrer",className:"text-xs underline decoration-slate-400 underline-offset-2 hover:opacity-80",title:"Ouvrir le PDF dans un nouvel onglet",children:"Ouvrir"})]}),e.jsxs("div",{className:"flex flex-col justify-center flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold leading-snug text-slate-800 truncate",children:s.label}),e.jsxs("p",{className:"text-xs text-slate-500 truncate",children:["Ordre ",s.order??s.sort_order??999]})]}),e.jsx("button",{onClick:()=>P(s),className:"h-9 rounded-xl px-3 text-sm font-medium shrink-0 focus:outline-none focus:ring-2 focus:ring-pfBlue focus:ring-offset-1 shadow hover:brightness-110 transition",style:{background:"#5784BA",color:"#fff"},children:"Modifier"})]})}),e.jsx("div",{className:"flex justify-end mt-3",children:e.jsx("button",{onClick:()=>O(s.id),className:"h-9 rounded-xl px-3 text-sm border border-slate-300 hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-pfBlue focus:ring-offset-1",children:"Supprimer"})})]},s.id))})})]})]}),e.jsxs("section",{className:"reveal js-reveal [--delay:200ms] mt-10 bg-white rounded-2xl shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-lg text-slate-800",children:"Derniers messages reçus"}),e.jsx(z,{to:"/admin/messages",className:"text-sm underline text-pfBlue hover:opacity-80",children:"Voir tous"})]}),A?e.jsx("p",{className:"text-sm text-slate-500 mt-3",children:"Chargement…"}):k?e.jsx("p",{className:"text-sm text-red-600 mt-3",children:String(k.message||k)}):(C||[]).length===0?e.jsx("p",{className:"text-sm text-slate-500 mt-3",children:"Aucun message pour l’instant."}):e.jsx("ul",{className:"mt-4 space-y-3",children:C.map((s,t)=>e.jsxs("li",{className:"reveal js-reveal rounded-xl border p-3 bg-slate-50",style:{"--delay":`${240+t*60}ms`},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-medium text-slate-900",children:s.subject||"(Sans sujet)"}),e.jsx("div",{className:"text-xs text-slate-500",children:new Date(s.created_at).toLocaleString("fr-FR")})]}),e.jsxs("div",{className:"text-xs text-slate-600 mt-1",children:["De :"," ",e.jsx("a",{href:`mailto:${s.email}`,className:"font-mono underline text-pfBlue hover:opacity-80 transition",children:s.email})]}),e.jsx("p",{className:"text-sm mt-2 line-clamp-3 text-slate-700",children:s.message})]},s.id))})]})]}),p&&e.jsx(Q,{doc:p,onClose:()=>b(null),onSaved:async()=>{b(null),j("Document modifié avec succès."),x(s=>s+1),setTimeout(()=>j(""),3e3)}})]})}function Q({doc:a,onClose:f,onSaved:y}){const[i,g]=r.useState(a.label||""),[h,u]=r.useState(a.tag||"Grossesse"),[p,b]=r.useState(a.order??a.sort_order??999),[m,j]=r.useState(a.doc_key||""),[n,w]=r.useState(null),[o,v]=r.useState(!1),[x,N]=r.useState("");r.useEffect(()=>{!m&&i&&j(_(i))},[i]);async function S(l){l.preventDefault(),N("");try{v(!0),await V(a.id,{label:i,tag:h,sort_order:Number(p),doc_key:m,file:n}),y?.()}catch(D){N(D.message||"Erreur lors de la modification")}finally{v(!1)}}return e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg w-full max-w-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800",children:"Modifier le document"}),e.jsx("button",{onClick:f,className:"rounded-lg px-2 py-1 text-sm border border-slate-300 hover:bg-slate-50",children:"Fermer"})]}),e.jsxs("form",{onSubmit:S,className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Titre (label)"}),e.jsx("input",{className:"w-full rounded-xl border border-slate-300 px-3 py-2 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-pfBlue",value:i,onChange:l=>g(l.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Tag"}),e.jsx("select",{className:"w-full rounded-xl border border-slate-300 px-3 py-2 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-pfBlue",value:h,onChange:l=>u(l.target.value),children:L.map(l=>e.jsx("option",{value:l,children:l},l))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Ordre"}),e.jsx("input",{type:"number",className:"w-full rounded-xl border border-slate-300 px-3 py-2 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-pfBlue",value:p,onChange:l=>b(Number(l.target.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Clé doc (doc_key)"}),e.jsx("input",{className:"w-full rounded-xl border border-slate-300 px-3 py-2 text-sm font-mono bg-white focus:outline-none focus:ring-2 focus:ring-pfBlue",value:m,onChange:l=>j(_(l.target.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Remplacer le fichier (optionnel)"}),e.jsx("input",{type:"file",accept:"application/pdf",className:"w-full rounded-xl border border-slate-300 px-3 py-2 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-pfBlue",onChange:l=>w(l.target.files?.[0]||null)}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Fichier actuel : ",e.jsx("span",{className:"underline",children:a.file_name})]})]}),x&&e.jsx("p",{className:"text-sm text-red-600",children:x}),e.jsxs("div",{className:"pt-2 flex gap-2 justify-end",children:[e.jsx("button",{type:"button",onClick:f,className:"rounded-xl px-3 py-2 text-sm border border-slate-300 hover:bg-slate-50",children:"Annuler"}),e.jsx("button",{type:"submit",disabled:o,className:"rounded-xl px-4 py-2 text-sm font-medium disabled:opacity-60 shadow hover:brightness-110 transition",style:{background:"#5784BA",color:"#fff"},children:o?"Enregistrement…":"Enregistrer"})]})]})]})})}export{ee as default};
//# sourceMappingURL=Dashboard-DJzgVSae.js.map
